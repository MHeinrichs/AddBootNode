/*                                                                            */

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/
        #include <exec/types.h>
        #include <exec/memory.h>
        #include <proto/exec.h>
        #include <proto/dos.h>
        #include <devices/trackdisk.h>
        #include <devices/hardblocks.h>
        #include <dos/filehandler.h>

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        struct iohandle {
                UWORD type;
                UWORD blksize;
                union {
                        BPTR f;
                        struct IOStdReq *req;
                        } hand;
                char *name;
                };

        #define IOHT_FILE   1
        #define IOHT_DEVICE 2

        #define MAXBLK   4096
        #define BLK_SIZE 512

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        struct iohandle *open_file (char *filename);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        struct iohandle *open_device (char *device,long unit);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        void close_io (struct iohandle *h);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        #define free_block(buffer)      FreeMem(buffer, BLK_SIZE)

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        APTR read_block (struct iohandle *h,ULONG block);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        BOOL write_block (struct iohandle *h,ULONG block,APTR buffer);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        ULONG check_sum (APTR buffer);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        BOOL read_list (struct iohandle *h,APTR *blocklist,long *toblock,long *list_addr,ULONG idname,char *name);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        BOOL read_rdb (struct iohandle *h,APTR *blocklist);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        void move_rdb (APTR *blocklist,long startblock);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        BOOL write_rdb (struct iohandle *h,APTR *blocklist,long startblock,BOOL erase);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        void free_rdb (APTR *blocklist);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/

        BOOL copy_rdb (struct iohandle *from,struct iohandle *to,long startblock,BOOL erase,BOOL force);

/*----------------------------------------------------------------------------*/
/*                                                                            */
/*----------------------------------------------------------------------------*/
